## 数据库索引

### 1.索引可以使用的数据结构

hash表， 二叉树，红黑树，B树， B+树

### 2.B+树作为索引的理由

**1. 先说说B+能够胜任这一工作的理由：**

* B+树，将索引值和整条数据分离，只在叶子结点上保存完整数据或者是数据的真正地址。这样可以让每个非叶子结点保存更多的索引范围，还能够大大减少树的高度，这样减少每个节点的平均查找长度，从而也减少了对树的节点的IO次数。
* B+树的叶子结点是从左到右互相连接的（双联表），能够方便的做到区间搜索,这是B树所不具有的特点

【如果每个树节点占16kb大小，每个索引数值如果是占用4个字节点, 地址占用4个字节，这样一个节点可以存放 16 / (4+4) k = 2k个节点】**还没有考证每个节点实际占用字节大小**

**2. B树和红黑树**： 不适合去区间查找

**3. 二叉树**： 不仅方便区间查找，每个节点只能区分两路分支，会让树非常高

**4. hash表**：需要固定的数组，hash公式不容易选，当hash冲突过多，维护成本也高，最关键的是不支持排序搜索呀(基本要求都达不到呢)

**【注】:mysql确实支持hash和B+树，但B+树才是最多用的，hash的没啥用**



## 相关问题

### 1. InnoDB和MyISAM引擎的区别

首先说明： InnoDB和MyISAM的引擎都是基于数据表级别的，可以为每张表单独指定使用哪个引擎

**数据存放位置区别：**

InnoDB表的数据放在2个文件中：(1) .ibd文件。(2) .frm 文件 

MyISAM表的数据放在三个文件中：(1) .MYI 文件。(2). frm文件。(3) .MYD文件

**【注】：**

* .ibd文件里面放置的数据是基于某个索引字段按照B+树组织起来的
* .frm文件里面放置的是该数据表的表结构信息
* .MYI文件类里面放置的是按照B+树组织的索引信息
* .MYD文件里面放置的是数据信息



### 2.为什么InnoDB数据表必须有主键

从以上可以看出InnoDB表必须有一个能够用于索引的主键，如果建表的时候不指定主键，则数据库会自己找一个适合做主键的字段(要求该字段的内容不重复)，如果找不到，数据库就会自己给隐形的增加一个能够区分的主键

所以尽量不要让数据库自己去做选择，而由建表的人去指定，会更加安全合理。

### 3.为什么InnoDB数据表的主键最好是自增的

这个要从插入数据的角度考虑：向B+树中插入节点，**如果主键自增**，这样每次都是向最后一个叶子节点插入新数据，可以最大限度减少增加数据时对整个B+树各个节点和层级的调整开销。**如果主键不是自增的，** 每次插入数据，就很容易影响到中间节点，导致中间节点变动，开销较多。 【可以模拟一下每个节点满了的时候，在最后插入数据和在前面叶子节点插入数据的不同】

### 4.为什么非主键索引结构叶子节点存储的是主键值

一致性和节省空间存储

因为用主键已经组织了一个B+索引结构了，再用其它非主键来组织索引，自然就只用一个主键来唯一标识每条数据就好了，不用重新存储。

这样，当修改的时候，只需要修改一个副本

### 5.聚集索引(聚簇索引)， 分离索引(稀疏索引)

* 从上面可以看到MyISAM引擎的索引结构和表数据是分开存储的，这个就是分离索引。

* InnoDB的数据和索引在同一个文件里，而且就是按照主键用B+树组织的索引结构化存储的，这个就是聚簇索引

